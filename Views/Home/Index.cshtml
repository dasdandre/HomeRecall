@model List<HomeRecall.Device>

<div class="card">
    <form method="post" asp-action="BackupSelected" asp-controller="Home">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <h2>Devices</h2>
            <button type="submit" class="btn">Backup Selected</button>
        </div>
        
        <table>
            <thead>
                <tr>
                    <th style="width: 40px;"><input type="checkbox" onclick="toggleAll(this)"></th>
                    <th>Name</th>
                    <th>IP Address</th>
                    <th>Type</th>
                    <th>Last Backup</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var device in Model)
                {
                    <tr>
                        <td><input type="checkbox" name="deviceIds" value="@device.Id"></td>
                        <td>@device.Name</td>
                        <td><a href="http://@device.IpAddress" target="_blank">@device.IpAddress</a></td>
                        <td>@device.Type</td>
                        <td>@(device.LastBackup?.ToString("g") ?? "Never")</td>
                        <td>
                            <!-- Link to details/backups page for this device -->
                            <a asp-controller="Backups" asp-action="Index" asp-route-deviceId="@device.Id">Backups (@device.Backups.Count)</a>
                        </td>
                    </tr>
                }
                @if (Model.Count == 0)
                {
                    <tr>
                        <td colspan="6" style="text-align: center;">No devices found. Add one below.</td>
                    </tr>
                }
            </tbody>
        </table>
    </form>
</div>

<div class="card">
    <h2>Add Device</h2>
    <form method="post" asp-action="AddDevice" asp-controller="Home" style="display: flex; gap: 10px; align-items: flex-end;">
        <div>
            <label style="display: block; font-size: 12px; color: var(--secondary-text-color);">Name</label>
            <input type="text" name="name" required style="padding: 8px;">
        </div>
        <div>
            <label style="display: block; font-size: 12px; color: var(--secondary-text-color);">IP Address</label>
            <input type="text" name="ip" required style="padding: 8px;">
        </div>
        <div>
            <label style="display: block; font-size: 12px; color: var(--secondary-text-color);">Type</label>
            <select name="type" style="padding: 8px;">
                <option value="Tasmota">Tasmota</option>
                <option value="Wled">WLED</option>
                <option value="Shelly">Shelly</option>
            </select>
        </div>
        <button type="submit" class="btn">Add</button>
    </form>
</div>
