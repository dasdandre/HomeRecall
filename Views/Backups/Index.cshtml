@model HomeRecall.Device

<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
        <h2>Backups for @Model.Name</h2>
        <a href="/" class="btn" style="background-color: var(--secondary-text-color);">Back</a>
    </div>

    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Checksum (SHA1)</th>
                <th>Note</th>
                <th>Locked</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var backup in Model.Backups.OrderByDescending(b => b.CreatedAt))
            {
                <tr>
                    <td>@backup.CreatedAt.ToString("g")</td>
                    <td style="font-family: monospace;">@backup.Sha1Checksum.Substring(0, 8)...</td>
                    <td>
                        <form method="post" action="/Backups/UpdateNote/@backup.Id" style="display: flex;">
                            <input type="text" name="note" value="@backup.Note" style="border: none; background: transparent; border-bottom: 1px solid #ccc; flex-grow: 1;">
                            <button type="submit" class="btn" style="padding: 2px 8px; font-size: 10px; margin-left: 4px;">Save</button>
                        </form>
                    </td>
                    <td>
                        <form method="post" action="/Backups/ToggleLock/@backup.Id">
                            <button type="submit" style="background: none; border: none; cursor: pointer; color: @(backup.IsLocked ? "red" : "gray");">
                                @(backup.IsLocked ? "Locked" : "Unlocked")
                            </button>
                        </form>
                    </td>
                    <td style="display: flex; gap: 4px;">
                        <form method="post" action="/Backups/Download/@backup.Id" style="display:inline;">
                            <button type="submit" class="btn">DL</button>
                        </form>
                        @if (!backup.IsLocked)
                        {
                            <form method="post" action="/Backups/Delete/@backup.Id" style="display:inline;" onsubmit="return confirm('Are you sure?');">
                                <button type="submit" class="btn" style="background-color: #f44336;">Del</button>
                            </form>
                        }
                    </td>
                </tr>
            }
            @if (Model.Backups.Count == 0)
            {
                <tr>
                    <td colspan="5" style="text-align: center;">No backups yet.</td>
                </tr>
            }
        </tbody>
    </table>
</div>
