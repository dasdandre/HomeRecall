<!-- Mobile View: Card List -->
<!-- Displayed on small screens only -->
<MudHidden Breakpoint="Breakpoint.MdAndUp">
    
    <!-- Filter Controls for Mobile -->
    <MudGrid class="mb-4">
        <MudItem xs="8">
            <MudTextField @bind-Value="SearchString" 
                         TextChanged="OnSearchChanged"
                         Adornment="Adornment.Start" 
                         AdornmentIcon="@Icons.Material.Filled.Search" 
                         IconSize="Size.Medium"></MudTextField>                    
        </MudItem>    
        <MudItem xs="4">
            <MudSelect T="DeviceType?" Value="FilterType" ValueChanged="OnFilterChanged" Clearable="true" Placeholder="@L["Devices_Table_Type"]">
                @foreach (DeviceType type in Enum.GetValues(typeof(DeviceType)))
                {
                    <MudSelectItem Value="(DeviceType?)type">@type</MudSelectItem>
                }
            </MudSelect>
        </MudItem>
    </MudGrid>           

    <!-- Device Cards -->
    <MudGrid Class="mb-4">
        @foreach (var device in Devices.Where(FilterFunc))
        {
            <MudItem xs="12">
                <MudCard Elevation="3">
                    <MudCardHeader>
                        <CardHeaderContent>
                            <MudText Typo="Typo.h6">@device.Name</MudText>
                            <MudLink Href="@($"http://{device.IpAddress}")" Target="_blank" Underline="Underline.Hover">@device.IpAddress</MudLink>
                        </CardHeaderContent>
                        <CardHeaderActions>
                            <MudChip T="string" Color="@UiHelpers.GetColorForDeviceType(device.Type)" Size="Size.Small" Variant="Variant.Text">@device.Type</MudChip>
                        </CardHeaderActions>
                    </MudCardHeader>
                    <MudCardContent>
                        <!-- Status Info (Firmware, AutoBackup, Backup Age) -->
                        <MudStack Row="true" Justify="Justify.SpaceBetween">
                            <MudText Typo="Typo.body2">Firmware: @(device.CurrentFirmwareVersion ?? "-")</MudText>                            
                        </MudStack>
                        <MudStack Row="true" Justify="Justify.SpaceBetween">
                            <MudText Typo="Typo.body2">Model: @(device.HardwareModel ?? "-")</MudText>
                        </MudStack>
                        <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
                            <div class="d-flex align-center gap-1">
                                <!-- Auto Backup Excluded Icon -->
                                @if (device.AutoBackupOverride == false)
                                {
                                    <MudTooltip Text="@L["Devices_AutoBackup_Excluded"]">
                                        <MudIcon Icon="@Icons.Material.Filled.HistoryToggleOff" Color="Color.Default" Size="Size.Small" />
                                    </MudTooltip>
                                }
                                <!-- Failure Icon -->
                                @if (device.BackupFailures > 0)
                                {
                                    <MudTooltip Text="@L["Devices_Backup_Failure_LastFailed"]">
                                        <MudIcon Icon="@Icons.Material.Filled.Warning" Color="Color.Warning" Size="Size.Small" />
                                    </MudTooltip>
                                }
                                
                                <!-- Last Backup Time -->
                                @if (device.LastBackup.HasValue)
                                {
                                    var daysSince = (DateTime.UtcNow - device.LastBackup.Value).TotalDays;
                                    var color = daysSince > 30 ? Color.Error : (daysSince > 7 ? Color.Warning : Color.Default);
                                    
                                    <MudIcon Icon="@Icons.Material.Filled.AccessTime" Size="Size.Small" Color="@color"/>
                                    <MudText Typo="Typo.body2">@device.LastBackup.Value.ToLocalTime().ToString("g")</MudText>
                                }
                            </div>
                        </MudStack>    
                    </MudCardContent>
                    <MudCardActions>
                        <!-- Action Buttons: Backup, History, Menu (Edit/Delete) -->
                        <MudButton Variant="Variant.Text" 
                                   Color="Color.Primary" 
                                   StartIcon="@(IsBackingUp.Contains(device.Id) ? null : Icons.Material.Filled.Backup)"
                                   Disabled="@(IsBackingUp.Contains(device.Id))"
                                   OnClick="@(() => OnBackupDevice.InvokeAsync(device))">
                            @if (IsBackingUp.Contains(device.Id))
                            {
                                <MudProgressCircular Class="ms-n1" Size="Size.Small" Indeterminate="true" />
                            }
                            else
                            {
                                @L["Common_Backup"]
                            }
                        </MudButton>
                        <MudButton Variant="Variant.Text" Color="Color.Secondary" StartIcon="@Icons.Material.Filled.History" OnClick="@(() => OnNavigateToBackups.InvokeAsync(device.Id))">
                            @L["Common_Backups"] (@device.Backups.Count)
                        </MudButton>
                        <MudSpacer />
                        <MudMenu Icon="@Icons.Material.Filled.MoreVert">
                            <MudMenuItem Icon="@Icons.Material.Filled.Edit" OnClick="@(() => OnEditDevice.InvokeAsync(device))">@L["Common_Edit"]</MudMenuItem>
                            <MudMenuItem Icon="@Icons.Material.Filled.Delete" OnClick="@(() => OnDeleteDevice.InvokeAsync(device))" IconColor="Color.Error">@L["Common_Delete"]</MudMenuItem>
                        </MudMenu>
                    </MudCardActions>
                </MudCard>
            </MudItem>
        }
    </MudGrid>
</MudHidden>
