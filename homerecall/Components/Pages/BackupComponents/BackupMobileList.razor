<!-- Mobile View: Card List -->
<!-- This view is only shown on small screens (md and down) -->
<MudHidden Breakpoint="Breakpoint.MdAndUp">
    <MudStack Spacing="3">
        @foreach (var backup in Backups.OrderByDescending(b => b.CreatedAt))
        {
            <MudCard Elevation="3">
                <MudCardHeader>
                    <CardHeaderContent>
                        <!-- Date and Firmware Info -->
                        <MudText Typo="Typo.body1" Style="font-weight: bold">@backup.CreatedAt.ToLocalTime().ToString("g")</MudText>
                        <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="1">
                            @if (!string.IsNullOrEmpty(backup.FirmwareVersion))
                            {
                                    <MudChip T="string" Size="Size.Small" Variant="Variant.Text" Color="Color.Default" Class="ml-0">@backup.FirmwareVersion</MudChip>
                            }
                            <!-- Shortened Checksum -->
                            <code style="font-size: 0.7rem">@backup.Sha1Checksum.Substring(0, Math.Min(8, backup.Sha1Checksum.Length))</code>
                        </MudStack>
                    </CardHeaderContent>
                    <CardHeaderActions>
                        <!-- Change Indicator (Icon shows if content changed compared to previous backup) -->
                        @if (IsDuplicateOfPrevious(backup))
                            {
                                <MudTooltip Text="@L["Backups_ContentUnchanged"]">
                                <MudIcon Icon="@Icons.Material.Filled.ContentCopy" Color="Color.Default" Size="Size.Small" />
                                </MudTooltip>
                            }
                            else
                            {
                                <MudTooltip Text="@L["Backups_ContentChanged"]">
                                <MudIcon Icon="@Icons.Material.Filled.Update" Color="Color.Success" Size="Size.Small" />
                                </MudTooltip>
                            }
                    </CardHeaderActions>
                </MudCardHeader>
                <MudCardContent Class="pt-0">
                        <!-- Editable Note Field -->
                        <MudTextField Value="@backup.Note"
                            ValueChanged="@((string s) => OnUpdateNote.InvokeAsync((backup, s)))"
                            Placeholder="@(L["Backups_Note"] + "...")"
                            Margin="Margin.Dense"
                            Variant="Variant.Text"
                            Immediate="true"/>
                </MudCardContent>
                <MudCardActions>
                    <!-- Actions: Lock, Download, Delete -->
                    <MudToggleIconButton Toggled="@backup.IsLocked"
                                            ToggledChanged="@((bool b) => OnToggleLock.InvokeAsync(backup))"
                                            Icon="@Icons.Material.Outlined.LockOpen"
                                            Color="@Color.Default"
                                            ToggledIcon="@Icons.Material.Filled.Lock"
                                            ToggledColor="@Color.Warning" />
                    <MudSpacer />
                    <MudIconButton Icon="@Icons.Material.Filled.Download"
                            Color="Color.Primary"
                            OnClick="@(() => OnDownloadBackup.InvokeAsync(backup))" />
                    <MudIconButton Icon="@Icons.Material.Filled.Delete"
                            Color="Color.Error"
                            OnClick="@(() => OnDeleteBackup.InvokeAsync(backup))"
                            Disabled="@backup.IsLocked" />
                </MudCardActions>
            </MudCard>
        }
    </MudStack>
</MudHidden>
